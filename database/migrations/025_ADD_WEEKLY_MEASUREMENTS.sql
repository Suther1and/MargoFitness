-- Миграция 025: Добавление weekly_measurements для недельной системы замеров тела
-- Эта миграция добавляет поддержку хранения замеров груди, талии и бедер с недельной группировкой

-- ============================================
-- Шаг 1: Добавление новой колонки weekly_measurements
-- ============================================

-- Добавляем колонку weekly_measurements в diary_entries
ALTER TABLE public.diary_entries 
ADD COLUMN IF NOT EXISTS weekly_measurements JSONB DEFAULT NULL;

COMMENT ON COLUMN public.diary_entries.weekly_measurements IS 
'Еженедельные замеры тела: {"chest": 95, "waist": 75, "hips": 100}';

-- ============================================
-- Шаг 2: Индексы для производительности
-- ============================================

-- GIN индекс для быстрого поиска внутри weekly_measurements
CREATE INDEX IF NOT EXISTS idx_diary_entries_weekly_measurements 
ON public.diary_entries USING GIN (weekly_measurements);

-- ============================================
-- Шаг 3: Примечания и документация
-- ============================================

-- Структура weekly_measurements:
-- {
--   "chest": 95,   -- Объем груди в см
--   "waist": 75,   -- Объем талии в см
--   "hips": 100    -- Объем бедер в см
-- }

-- ВАЖНО: 
-- 1. Все поля опциональны - можно сохранять частичные замеры
-- 2. Замеры привязаны к неделе, как и фото (week_key)
-- 3. Хранятся в той же строке diary_entries, где date = week_key (понедельник недели)
-- 4. Значения в сантиметрах (см)

-- ============================================
-- Готово!
-- ============================================
