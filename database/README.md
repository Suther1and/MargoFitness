# üóÑÔ∏è Database / SQL –ú–∏–≥—Ä–∞—Ü–∏–∏

–í—Å–µ SQL —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Supabase.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
database/
‚îú‚îÄ‚îÄ migrations/          ‚Üê –í—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ 001_CLEAN_SETUP.sql
‚îÇ   ‚îú‚îÄ‚îÄ 002_FREE_CONTENT_SETUP.sql
‚îÇ   ‚îî‚îÄ‚îÄ 003_ADMIN_RLS_FIX.sql
‚îî‚îÄ‚îÄ README.md           ‚Üê –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## üöÄ –ú–∏–≥—Ä–∞—Ü–∏–∏

### 001_CLEAN_SETUP.sql
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ë–î —Å –Ω—É–ª—è
- –°–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü (profiles, products, content_weeks, workout_sessions, exercises, etc.)
- ENUM —Ç–∏–ø—ã (subscription_tier)
- RLS –ø–æ–ª–∏—Ç–∏–∫–∏
- –¢—Ä–∏–≥–≥–µ—Ä—ã (–∞–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è, updated_at)
- –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

**–ö–æ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—å:** –ü—Ä–∏ –ø–µ—Ä–≤–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏–ª–∏ –ø–æ–ª–Ω–æ–º —Å–±—Ä–æ—Å–µ –ë–î

---

### 002_FREE_CONTENT_SETUP.sql
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
- –¢–∞–±–ª–∏—Ü–∞ free_content
- RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- 3 —Ç–µ—Å—Ç–æ–≤—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–∞
- –¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è updated_at

**–ö–æ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—å:** –ü–æ—Å–ª–µ 001_CLEAN_SETUP.sql

---

### 003_ADMIN_RLS_FIX.sql
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ  
**–û–ø–∏—Å–∞–Ω–∏–µ:** RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω—Å–∫–æ–≥–æ –ø–æ–ª–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- –ê–¥–º–∏–Ω SELECT/INSERT/UPDATE/DELETE –¥–ª—è content_weeks
- –ê–¥–º–∏–Ω SELECT/INSERT/UPDATE/DELETE –¥–ª—è workout_sessions
- –ê–¥–º–∏–Ω SELECT/INSERT/UPDATE/DELETE –¥–ª—è exercises
- –ê–¥–º–∏–Ω SELECT/INSERT/UPDATE/DELETE –¥–ª—è free_content

**–ö–æ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—å:** –ü–æ—Å–ª–µ 001 –∏ 002, –∫–æ–≥–¥–∞ –Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

---

### 004_ENUM_OPTIMIZATION.sql
**–°—Ç–∞—Ç—É—Å:** üÜï –ù–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è  
**–û–ø–∏—Å–∞–Ω–∏–µ:** ENUM —Ç–∏–ø—ã –¥–ª—è dropdown –≤ Supabase UI
- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ `role` –∏–∑ text –≤ ENUM (user | admin)
- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ `subscription_status` –∏–∑ text –≤ ENUM (active | inactive | canceled)
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —Å—Ç–æ–ª–±—Ü–∞–º –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–æ–∫
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–∞ handle_new_user()

**–ö–æ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—å:** –ü–æ—Å–ª–µ 001, 002, 003 –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è Supabase Table Editor

‚ö†Ô∏è **–í–ê–ñ–ù–û:** –°–¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø –ë–î –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º!

**–ü–æ–¥—Ä–æ–±–Ω–µ–µ:** –°–º. [`docs/guides/ENUM_MIGRATION_GUIDE.md`](../docs/guides/ENUM_MIGRATION_GUIDE.md)

---

## üìù –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π

```bash
# 1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard ‚Üí SQL Editor
# 2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É:

# –®–∞–≥ 1: –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
‚Üí 001_CLEAN_SETUP.sql

# –®–∞–≥ 2: –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
‚Üí 002_FREE_CONTENT_SETUP.sql

# –®–∞–≥ 3: –ê–¥–º–∏–Ω—Å–∫–∏–µ –ø—Ä–∞–≤–∞
‚Üí 003_ADMIN_RLS_FIX.sql

# –®–∞–≥ 4: ENUM –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
‚Üí 004_ENUM_OPTIMIZATION.sql
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

- **–í—ã–ø–æ–ª–Ω—è–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É** (001 ‚Üí 002 ‚Üí 003)
- **–ü–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º** —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–µ–¥—ã–¥—É—â–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
- **–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ë–î** –æ–±–Ω–æ–≤–ª—è–π—Ç–µ TypeScript —Ç–∏–ø—ã

---

## üîÑ –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

1. –°–æ–∑–¥–∞–π—Ç–µ –±—ç–∫–∞–ø –≤ Supabase Dashboard (Database ‚Üí Backups)
2. –î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–±—Ä–æ—Å–∞: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ 001_CLEAN_SETUP.sql
3. –ò–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏–∑ –±—ç–∫–∞–ø–∞

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–°–º–æ—Ç—Ä–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ [`docs/`](../docs/) –ø–∞–ø–∫–µ.

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 23 –¥–µ–∫–∞–±—Ä—è 2025

