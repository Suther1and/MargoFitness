# Health Tracker - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Supabase

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è `022_UPDATE_HEALTH_DIARY.sql`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü –ø–æ–¥ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –ø–æ–ª—è (–ö–ë–ñ–£, sleepQuality)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø–æ–ª—è (habits, foodQuality, photo_urls)

### 2. Server Actions
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã `lib/actions/diary.ts` –ø–æ–¥ –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î
- ‚úÖ –°–æ–∑–¥–∞–Ω `lib/actions/health-stats.ts` –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

### 3. Client Hooks
- ‚úÖ –°–æ–∑–¥–∞–Ω `useHealthDiary` —Å optimistic updates –∏ debounce
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `use-tracker-settings` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Supabase
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `use-habits` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Supabase

### 4. UI Integration
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω `useHealthDiary` –≤ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `stats-tab.tsx` –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ dateRange
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `stats-water.tsx` –∫–∞–∫ –ø—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

### 5. –¢–∏–ø—ã
- ‚úÖ –û—á–∏—â–µ–Ω—ã –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–ª—è –∏–∑ `types.ts`
- ‚úÖ MOCK_DATA –æ–±–Ω—É–ª–µ–Ω (–¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ –ë–î)

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤ Supabase

–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∏–∑ —Ñ–∞–π–ª–∞ `database/migrations/022_UPDATE_HEALTH_DIARY.sql` –≤ Supabase SQL Editor.

**–í–∞–∂–Ω–æ:** –≠—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏—è —É–¥–∞–ª–∏—Ç —Å—Ç–∞—Ä—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü –∏ —Å–æ–∑–¥–∞—Å—Ç –Ω–æ–≤—É—é. –ï—Å–ª–∏ –µ—Å—Ç—å –≤–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, —Å–¥–µ–ª–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é!

### 2. –û–±–Ω–æ–≤–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç `stats-water.tsx` –æ–±–Ω–æ–≤–ª–µ–Ω –∫–∞–∫ –ø—Ä–∏–º–µ—Ä. –û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏:

- `stats-steps.tsx`
- `stats-weight.tsx`
- `stats-caffeine.tsx`
- `stats-sleep.tsx`
- `stats-mood.tsx`
- `stats-nutrition.tsx`
- `stats-habits.tsx`
- `stats-notes.tsx`
- `stats-photos.tsx`

**–®–∞–±–ª–æ–Ω –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
```typescript
// 1. –ò–∑–º–µ–Ω–∏—Ç—å props —Å period –Ω–∞ dateRange
interface StatsXProps {
  dateRange: { start: Date; end: Date }  // –±—ã–ª–æ: period: string
}

// 2. –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö
const [data, setData] = useState([])
const [isLoading, setIsLoading] = useState(true)

useEffect(() => {
  async function loadData() {
    const supabase = createClient()
    const { data: { user } } = await supabase.auth.getUser()
    if (!user) return
    
    const result = await getXStats(user.id, dateRange)
    if (result.success) setData(result.data)
    setIsLoading(false)
  }
  loadData()
}, [dateRange])

// 3. –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –ø—É—Å—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö
if (isLoading) return <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>
if (!data.length) return <div>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>
```

## üìä –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Optimistic Updates (–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π UI)
```typescript
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç "+250–º–ª –≤–æ–¥—ã"
updateMetric('waterIntake', 1500)

// ‚úÖ UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ú–ì–ù–û–í–ï–ù–ù–û (0ms)
// ‚è±Ô∏è –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î —á–µ—Ä–µ–∑ 2 —Å–µ–∫ –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
// üíæ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –æ–∫–Ω–∞
```

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–Ω–µ–π
```typescript
// –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ –¥—Ä—É–≥–æ–π –¥–µ–Ω—å:
// 1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫—ç—à –≤ –ø–∞–º—è—Ç–∏ (0ms)
// 2. –ï—Å–ª–∏ –Ω–µ—Ç –≤ –∫—ç—à–µ - –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –ë–î (15-30ms)
// 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫—ç—à –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤–∏–∑–∏—Ç–∞
```

### Debounced —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
```typescript
// –ö–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
// ‚úÖ UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
// ‚è±Ô∏è –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î —á–µ—Ä–µ–∑ 1 —Å–µ–∫ –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
```

## üîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- [ ] –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –Ω–∞ —Å–µ–≥–æ–¥–Ω—è (–¥–æ–±–∞–≤–∏—Ç—å –≤–æ–¥—É, —à–∞–≥–∏, –∏ —Ç.–¥.)
- [ ] –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –≤—á–µ—Ä–∞—à–Ω–∏–π –¥–µ–Ω—å
- [ ] –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è (–¥–æ–ª–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è –∏–∑ –∫—ç—à–∞)
- [ ] –ó–∞–∫—Ä—ã—Ç—å –∏ –æ—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É (–¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è)

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- [ ] –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –≤–∏–¥–∂–µ—Ç—ã
- [ ] –ò–∑–º–µ–Ω–∏—Ç—å —Ü–µ–ª–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É
- [ ] –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è)

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
- [ ] –û—Ç–∫—Ä—ã—Ç—å –≤–∫–ª–∞–¥–∫—É "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"
- [ ] –í—ã–±—Ä–∞—Ç—å –ø–µ—Ä–∏–æ–¥ (7–¥, 30–¥, –∏ —Ç.–¥.)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–§–æ—Ç–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞** - —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, –Ω–æ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏
2. **–û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏** - —Ä–∞–±–æ—Ç–∞—é—Ç —Å –º–æ–∫–∞–º–∏, –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å `stats-water.tsx`
3. **Stats Overall** - –≤—Å–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ä—ã–π `period` –≤–º–µ—Å—Ç–æ `dateRange`

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Å Row Level Security (RLS)
- –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
- –ê–¥–º–∏–Ω—ã –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –¥–∞–Ω–Ω—ã–º
- –°—Ç—Ä–∏–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ SQL —Ñ—É–Ω–∫—Ü–∏—é
- –ò–Ω–¥–µ–∫—Å—ã –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –±—ã—Å—Ç—Ä—É—é –∑–∞–≥—Ä—É–∑–∫—É (< 30ms)

## üéØ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- –ö–ª–∏–∫ –Ω–∞ –≤–∏–¥–∂–µ—Ç: **0ms** (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ)
- –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: **15-30ms**
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –¥–Ω—è (cached): **0ms**
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –¥–Ω—è (uncached): **10-20ms**
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î: **—Ñ–æ–Ω–æ–≤–æ–µ, 2 —Å–µ–∫ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è**

## üêõ Troubleshooting

### "Table diary_settings not found"
- –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é 022 –≤ Supabase

### "User not authenticated"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ª–æ–≥–∏–Ω–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –≤ Supabase

### –î–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –æ—à–∏–±–æ–∫
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network tab –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Supabase

### –ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω–¥–µ–∫—Å—ã –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ React Query –¥–ª—è –ª—É—á—à–µ–≥–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

