# üìß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## –ü—Ä–æ–≤–∞–π–¥–µ—Ä: Resend

–ò—Å–ø–æ–ª—å–∑—É–µ–º [Resend](https://resend.com/) –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Resend

- ‚úÖ –ü—Ä–æ—Å—Ç–æ–π –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π API
- ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–æ 3000 –ø–∏—Å–µ–º/–º–µ—Å—è—Ü
- ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Next.js
- ‚úÖ –ö—Ä–∞—Å–∏–≤—ã–π dashboard –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ custom domains

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [resend.com](https://resend.com/)
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å (–º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ GitHub)
3. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ email

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–∞

1. –í dashboard –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **API Keys**
2. –ù–∞–∂–º–∏—Ç–µ **Create API Key**
3. –ù–∞–∑–æ–≤–∏—Ç–µ –∫–ª—é—á (–Ω–∞–ø—Ä–∏–º–µ—Ä, "MargoFitness Development")
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–ª—é—á (–æ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑!)

### 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ –≤–∞—à `.env.local`:

```bash
# Email (Resend)
RESEND_API_KEY=re_–≤–∞—à_api_–∫–ª—é—á_–∑–¥–µ—Å—å
EMAIL_FROM=MargoFitness <onboarding@resend.dev>

# App URL –¥–ª—è —Å—Å—ã–ª–æ–∫ –≤ –ø–∏—Å—å–º–∞—Ö
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –¥–æ–º–µ–Ω `onboarding@resend.dev` (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω).

**–í–∞–∂–Ω–æ:** –ù–∞ —Ç–µ—Å—Ç–æ–≤–æ–º –¥–æ–º–µ–Ω–µ –ø–∏—Å—å–º–∞ –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞:
- –í–∞—à –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π email –≤ Resend
- Email —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ —Ä–∞–∑–¥–µ–ª–µ "Testing"

## Production –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–≤–æ–µ–≥–æ –¥–æ–º–µ–Ω–∞

1. –í Resend dashboard –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Domains**
2. –ù–∞–∂–º–∏—Ç–µ **Add Domain**
3. –í–≤–µ–¥–∏—Ç–µ –≤–∞—à –¥–æ–º–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, `margofitness.ru`)
4. –î–æ–±–∞–≤—å—Ç–µ DNS –∑–∞–ø–∏—Å–∏ (–ø–æ–∫–∞–∑–∞–Ω—ã –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ):
   - **MX** –∑–∞–ø–∏—Å—å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–∏—Å–µ–º
   - **TXT** –∑–∞–ø–∏—Å–∏ –¥–ª—è SPF –∏ DKIM (–∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞)
5. –î–æ–∂–¥–∏—Ç–µ—Å—å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–æ–±—ã—á–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç)

–ü–æ—Å–ª–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–∏—Ç–µ –≤ `.env.local`:

```bash
EMAIL_FROM=MargoFitness <noreply@margofitness.ru>
```

### Production checklist

- [ ] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–æ–º–µ–Ω –≤ Resend
- [ ] –î–æ–±–∞–≤–∏—Ç—å DNS –∑–∞–ø–∏—Å–∏
- [ ] –î–æ–∂–¥–∞—Ç—å—Å—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–æ–º–µ–Ω–∞
- [ ] –°–æ–∑–¥–∞—Ç—å production API key
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–ª—é—á –≤ Vercel Environment Variables
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `EMAIL_FROM` –Ω–∞ —Å–≤–æ–π –¥–æ–º–µ–Ω
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –ø–∏—Å–µ–º

## –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### 1. –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø–∏—Å—å–º–æ
**–ö–æ–≥–¥–∞:** –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏  
**–¢—Ä–∏–≥–≥–µ—Ä:** `app/auth/callback/route.ts`  
**–§—É–Ω–∫—Ü–∏—è:** `sendWelcomeEmail()`

### 2. –£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞
**–ö–æ–≥–¥–∞:** –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞  
**–¢—Ä–∏–≥–≥–µ—Ä:** `app/api/payments/webhook/route.ts`  
**–§—É–Ω–∫—Ü–∏—è:** `sendPaymentSuccessEmail()`

### 3. –ê–ø–≥—Ä–µ–π–¥ –ø–æ–¥–ø–∏—Å–∫–∏
**–ö–æ–≥–¥–∞:** –ü—Ä–∏ –ø–æ–≤—ã—à–µ–Ω–∏–∏ —Ç–∞—Ä–∏—Ñ–∞  
**–¢—Ä–∏–≥–≥–µ—Ä:** `app/api/payments/upgrade/route.ts`  
**–§—É–Ω–∫—Ü–∏—è:** `sendSubscriptionUpgradeEmail()`

### 4. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
**–ö–æ–≥–¥–∞:** –ê–∫—Ç–∏–≤–∞—Ü–∏—è, –ø—Ä–æ–¥–ª–µ–Ω–∏–µ, –æ—Ç–º–µ–Ω–∞, –∏—Å—Ç–µ—á–µ–Ω–∏–µ  
**–¢—Ä–∏–≥–≥–µ—Ä:** –†–∞–∑–ª–∏—á–Ω—ã–µ –º–µ—Å—Ç–∞ –≤ –∫–æ–¥–µ  
**–§—É–Ω–∫—Ü–∏—è:** `sendSubscriptionChangeEmail()`

## API Reference

### sendWelcomeEmail

```typescript
await sendWelcomeEmail({
  to: 'user@example.com',
  userName: '–ò–≤–∞–Ω'
})
```

### sendPaymentSuccessEmail

```typescript
await sendPaymentSuccessEmail({
  to: 'user@example.com',
  userName: '–ò–≤–∞–Ω',
  planName: 'Pro 3 –º–µ—Å—è—Ü–∞',
  amount: 12822,
  duration: 3,
  expiresAt: '2024-03-24T10:00:00Z'
})
```

### sendSubscriptionUpgradeEmail

```typescript
await sendSubscriptionUpgradeEmail({
  to: 'user@example.com',
  userName: '–ò–≤–∞–Ω',
  oldPlan: 'Basic',
  newPlan: 'Pro',
  bonusDays: 28,
  totalDays: 208
})
```

### sendSubscriptionChangeEmail

```typescript
await sendSubscriptionChangeEmail({
  to: 'user@example.com',
  userName: '–ò–≤–∞–Ω',
  changeType: 'renewed', // 'activated' | 'renewed' | 'cancelled' | 'expired'
  planName: 'Pro',
  details: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è'
})
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ email:
- –í–æ–∑–≤—Ä–∞—â–∞—é—Ç `boolean` (—É—Å–ø–µ—Ö/–Ω–µ—É–¥–∞—á–∞)
- –õ–æ–≥–∏—Ä—É—é—Ç –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª—å
- **–ù–µ –±–ª–æ–∫–∏—Ä—É—é—Ç** –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª (fire and forget)

–ü—Ä–∏–º–µ—Ä:

```typescript
const emailSent = await sendWelcomeEmail({ to: user.email })
if (!emailSent) {
  console.warn('Welcome email not sent, but user created successfully')
}
// –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–í Resend dashboard –¥–æ—Å—Ç—É–ø–Ω–æ:
- –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø–∏—Å–µ–º
- –°—Ç–∞—Ç—É—Å—ã –¥–æ—Å—Ç–∞–≤–∫–∏
- Bounce –∏ complaint rate
- API usage —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

## –õ–∏–º–∏—Ç—ã

### Free –ø–ª–∞–Ω
- 3,000 –ø–∏—Å–µ–º/–º–µ—Å—è—Ü
- 100 –ø–∏—Å–µ–º/–¥–µ–Ω—å
- –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è MVP –∏ –Ω–∞—á–∞–ª—å–Ω–æ–π —Å—Ç–∞–¥–∏–∏

### Paid –ø–ª–∞–Ω—ã
- –û—Ç $20/–º–µ—Å—è—Ü –∑–∞ 50,000 –ø–∏—Å–µ–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π scaling
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞

## Troubleshooting

### –ü–∏—Å—å–º–∞ –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á:** –û–Ω –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å `re_`
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ FROM –∞–¥—Ä–µ—Å:** –î–ª—è —Ç–µ—Å—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `onboarding@resend.dev`
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ø–∞–º:** –ü–∏—Å—å–º–∞ –º–æ–≥—É—Ç –ø–æ–ø–∞—Å—Ç—å –≤ —Å–ø–∞–º
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:** –°–º–æ—Ç—Ä–∏—Ç–µ console.log –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Resend dashboard:** –¢–∞–º –≤–∏–¥–Ω—ã –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏

### –û—à–∏–±–∫–∞ "Unauthorized"

- API –∫–ª—é—á –Ω–µ–≤–µ—Ä–Ω—ã–π –∏–ª–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ `.env.local`
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π

### –û—à–∏–±–∫–∞ "Invalid recipient"

- –ù–∞ —Ç–µ—Å—Ç–æ–≤–æ–º –¥–æ–º–µ–Ω–µ –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π email
- –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ email –≤ Resend dashboard ‚Üí Testing

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Resend –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://resend.com/docs)
- [Resend API Reference](https://resend.com/docs/api-reference)
- [Resend GitHub](https://github.com/resendlabs/resend-node)

