# –°–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π

–ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –¥–ª—è health tracker —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –±–æ–Ω—É—Å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã.

## üìã –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –º–æ—Ç–∏–≤–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ä–µ–≥—É–ª—è—Ä–Ω–æ –∑–∞–ø–æ–ª–Ω—è—Ç—å –¥–Ω–µ–≤–Ω–∏–∫ –∑–¥–æ—Ä–æ–≤—å—è –∏ —Å–ª–µ–¥–∏—Ç—å –∑–∞ —Å–≤–æ–∏–º–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º–∏. –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —É—Å–ª–æ–≤–∏–π –∏ –º–æ–≥—É—Ç –¥–∞–≤–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—ã –≤ –≤–∏–¥–µ –±–æ–Ω—É—Å–æ–≤ (–®–∞–≥–æ–≤ üëü).

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã

#### `achievements` - –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
- `id` - UUID –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
- `title` - –ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ù–µ–¥–µ–ª—è —Å–∏–ª—ã")
- `description` - –û–ø–∏—Å–∞–Ω–∏–µ —É—Å–ª–æ–≤–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ó–∞–ø–æ–ª–Ω—è—Ç—å –¥–Ω–µ–≤–Ω–∏–∫ 7 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥")
- `category` - –ö–∞—Ç–µ–≥–æ—Ä–∏—è (streaks, metrics, habits, weight, consistency, workouts)
- `is_secret` - –°–∫—Ä—ã—Ç–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å –∑–∞–≥–ª—É—à–∫–æ–π –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è)
- `reward_amount` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ –≤ –Ω–∞–≥—Ä–∞–¥—É (NULL = –±–µ–∑ –Ω–∞–≥—Ä–∞–¥—ã)
- `icon` - –≠–º–æ–¥–∑–∏ –∏–ª–∏ –∏–∫–æ–Ω–∫–∞
- `color_class` - CSS –∫–ª–∞—Å—Å –¥–ª—è —Ü–≤–µ—Ç–∞
- `metadata` - JSONB —Å —É—Å–ª–æ–≤–∏—è–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏
- `sort_order` - –ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
- `created_at` - –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è

#### `user_achievements` - –ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
- `id` - UUID –∑–∞–ø–∏—Å–∏
- `user_id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `achievement_id` - ID –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
- `unlocked_at` - –î–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è
- UNIQUE(user_id, achievement_id) - –æ–¥–Ω–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑

### Enum —Ç–∏–ø—ã

```sql
CREATE TYPE achievement_category AS ENUM (
  'streaks',      -- –°–µ—Ä–∏–∏ (–¥–Ω–∏ –ø–æ–¥—Ä—è–¥)
  'metrics',      -- –ú–µ—Ç—Ä–∏–∫–∏ (–≤–æ–¥–∞, —à–∞–≥–∏ –∏ —Ç.–¥.)
  'habits',       -- –ü—Ä–∏–≤—ã—á–∫–∏
  'weight',       -- –í–µ—Å –∏ —Ü–µ–ª–∏
  'consistency',  -- –†–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
  'workouts'      -- –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (–±—É–¥—É—â–µ–µ)
);
```

### –§—É–Ω–∫—Ü–∏—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

```sql
unlock_achievement_for_user(p_user_id UUID, p_achievement_id UUID)
```

–ë–µ–∑–æ–ø–∞—Å–Ω–æ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ:
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–µ –ø–æ–ª—É—á–µ–Ω–æ –ª–∏ —É–∂–µ
2. –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ `user_achievements`
3. –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–∞–≥—Ä–∞–¥–∞ - —Å–æ–∑–¥–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ `bonus_transactions`
4. –û–±–Ω–æ–≤–ª—è–µ—Ç –±–∞–ª–∞–Ω—Å –≤ `user_bonuses`

## üìä –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π

### üî• –°–µ—Ä–∏–∏ (Streaks)
–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω–∏–∫–∞ N –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥:
- "–ü–µ—Ä–≤—ã–π —à–∞–≥" - 1 –¥–µ–Ω—å
- "–ù–µ–¥–µ–ª—è —Å–∏–ª—ã" - 7 –¥–Ω–µ–π (50 —à–∞–≥–æ–≤)
- "–î–≤–µ –Ω–µ–¥–µ–ª–∏" - 14 –¥–Ω–µ–π (100 —à–∞–≥–æ–≤)
- "–ú–µ—Å—è—Ü –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã" - 30 –¥–Ω–µ–π (200 —à–∞–≥–æ–≤)
- "–ñ–µ–ª–µ–∑–Ω–∞—è –≤–æ–ª—è" (—Å–µ–∫—Ä–µ—Ç) - 100 –¥–Ω–µ–π (500 —à–∞–≥–æ–≤)

### üìä –ú–µ—Ç—Ä–∏–∫–∏ (Metrics)
–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º –∑–¥–æ—Ä–æ–≤—å—è:
- "–í–æ–¥–æ—Ö–ª—ë–±" - 2.5–ª –≤–æ–¥—ã –∑–∞ –¥–µ–Ω—å
- "–û–∫–µ–∞–Ω" - 100–ª –≤–æ–¥—ã –≤—Å–µ–≥–æ (50 —à–∞–≥–æ–≤)
- "–ú–∞—Ä–∞—Ñ–æ–Ω–µ—Ü" - 10000 —à–∞–≥–æ–≤ –∑–∞ –¥–µ–Ω—å
- "–£–ª—å—Ç—Ä–∞–º–∞—Ä–∞—Ñ–æ–Ω" (—Å–µ–∫—Ä–µ—Ç) - 25000 —à–∞–≥–æ–≤ (100 —à–∞–≥–æ–≤)
- "–ì–∏–≥–∞—à–∞–≥–∏" - 1000000 —à–∞–≥–æ–≤ –≤—Å–µ–≥–æ (150 —à–∞–≥–æ–≤)
- "–°–æ–Ω–Ω—ã–π –∫–æ—Ä–æ–ª—å" - —Å–ø–∞—Ç—å 8+ —á–∞—Å–æ–≤
- "–ù–µ–¥–µ–ª—è —Å–Ω–∞" - —Å–ø–∞—Ç—å 8+ —á–∞—Å–æ–≤ 7 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥ (75 —à–∞–≥–æ–≤)

### ‚ú® –ü—Ä–∏–≤—ã—á–∫–∏ (Habits)
–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–µ–∫:
- "–ù–∞—á–∞–ª–æ –ø—É—Ç–∏" - –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ª—é–±—É—é –ø—Ä–∏–≤—ã—á–∫—É
- "–ü—Ä–∏–≤—ã—á–Ω—ã–π —Ä–µ–∂–∏–º" - –≤—Å–µ –ø—Ä–∏–≤—ã—á–∫–∏ 5 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥ (75 —à–∞–≥–æ–≤)
- "–•–æ–∑—è–∏–Ω —Å–≤–æ–µ–π –∂–∏–∑–Ω–∏" (—Å–µ–∫—Ä–µ—Ç) - –≤—Å–µ –ø—Ä–∏–≤—ã—á–∫–∏ 30 –¥–Ω–µ–π (250 —à–∞–≥–æ–≤)
- "–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä" - —Å–æ–∑–¥–∞—Ç—å 10 –ø—Ä–∏–≤—ã—á–µ–∫ (50 —à–∞–≥–æ–≤)
- "–°—Ç–æ–ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∏–∫" - –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É 100 —Ä–∞–∑ (100 —à–∞–≥–æ–≤)

### ‚öñÔ∏è –í–µ—Å (Weight)
–ö–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Å–∞:
- "–ü–µ—Ä–≤–∞—è –æ—Ç–º–µ—Ç–∫–∞" - –∑–∞–ø–∏—Å–∞—Ç—å –≤–µ—Å –ø–µ—Ä–≤—ã–π —Ä–∞–∑
- "–ö–æ–Ω—Ç—Ä–æ–ª—å" - –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤–µ—Å 7 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥ (50 —à–∞–≥–æ–≤)
- "–ú–µ—Å—è—Ü –∫–æ–Ω—Ç—Ä–æ–ª—è" - –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤–µ—Å 30 –¥–Ω–µ–π (100 —à–∞–≥–æ–≤)
- "–¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞!" - –¥–æ—Å—Ç–∏—á—å —Ü–µ–ª–µ–≤–æ–≥–æ –≤–µ—Å–∞ (300 —à–∞–≥–æ–≤)
- "–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å" (—Å–µ–∫—Ä–µ—Ç) - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ü–µ–ª–µ–≤–æ–π –≤–µ—Å 14 –¥–Ω–µ–π (200 —à–∞–≥–æ–≤)

### üìÖ –†–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å (Consistency)
–†–µ–≥—É–ª—è—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–µ—Ä–∞:
- "–ü–æ—Å—Ç–æ—è–Ω—Å—Ç–≤–æ" - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 15 –¥–Ω–µ–π –≤ –º–µ—Å—è—Ü (100 —à–∞–≥–æ–≤)
- "–ò–¥–µ–∞–ª—å–Ω—ã–π –º–µ—Å—è—Ü" (—Å–µ–∫—Ä–µ—Ç) - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 30 –¥–Ω–µ–π –º–µ—Å—è—Ü–∞ (400 —à–∞–≥–æ–≤)
- "–í–µ—Ç–µ—Ä–∞–Ω" - 100 –¥–Ω–µ–π –≤—Å–µ–≥–æ (150 —à–∞–≥–æ–≤)
- "–õ–µ–≥–µ–Ω–¥–∞" (—Å–µ–∫—Ä–µ—Ç) - 365 –¥–Ω–µ–π –≤—Å–µ–≥–æ (500 —à–∞–≥–æ–≤)

### üèãÔ∏è –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (Workouts - –±—É–¥—É—â–µ–µ)
–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫:
- "–ü–µ—Ä–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞" - –∑–∞–≤–µ—Ä—à–∏—Ç—å 1 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
- "–ù–µ–¥–µ–ª—å–Ω—ã–π —Ü–∏–∫–ª" - 7 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ (75 —à–∞–≥–æ–≤)
- "–ê—Ç–ª–µ—Ç" - 30 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ (150 —à–∞–≥–æ–≤)
- "–ú–∞—Å—Ç–µ—Ä —Å–ø–æ—Ä—Ç–∞" (—Å–µ–∫—Ä–µ—Ç) - 100 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ (300 —à–∞–≥–æ–≤)

### üéØ –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ/–°–µ–∫—Ä–µ—Ç–Ω—ã–µ
- "–ù–æ—á–Ω–∞—è —Å–æ–≤–∞" (—Å–µ–∫—Ä–µ—Ç) - –∑–∞–ø–∏—Å–∞—Ç—å —Å–æ–Ω < 4 —á–∞—Å–æ–≤
- "–ò–¥–µ–∞–ª—å–Ω—ã–π –¥–µ–Ω—å" (—Å–µ–∫—Ä–µ—Ç) - –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ —Ü–µ–ª–∏ –∑–∞ –¥–µ–Ω—å (150 —à–∞–≥–æ–≤)
- "–ü–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏—Å—Ç" (—Å–µ–∫—Ä–µ—Ç) - –≤—Å–µ —Ü–µ–ª–∏ 7 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥ (250 —à–∞–≥–æ–≤)
- "–ì–∏–¥—Ä–∞—Ç–æ—Ä" (—Å–µ–∫—Ä–µ—Ç) - —Ü–µ–ª—å –ø–æ –≤–æ–¥–µ 30 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥ (200 —à–∞–≥–æ–≤)
- "–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫" - —ç–Ω–µ—Ä–≥–∏—è 5/5 –¥–µ—Å—è—Ç—å —Ä–∞–∑ (50 —à–∞–≥–æ–≤)
- "–†–∞–¥–æ—Å—Ç—å –∂–∏–∑–Ω–∏" (—Å–µ–∫—Ä–µ—Ç) - –æ—Ç–ª–∏—á–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ 14 –¥–Ω–µ–π (150 —à–∞–≥–æ–≤)

**–í—Å–µ–≥–æ: 37 –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π**

## üíª API (Server Actions)

### –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

```typescript
// –í—Å–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
await getAllAchievements()

// –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
await getUserAchievements(userId)

// –ü–æ—Å–ª–µ–¥–Ω–∏–µ 3 –¥–ª—è –≤–∏–¥–∂–µ—Ç–∞
await getRecentAchievements(userId, 3)

// –í—Å–µ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–µ
await getAllAchievementsWithStatus(userId)

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
await getAchievementStats(userId)
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: { total, unlocked, percentage, recentUnlocked }
```

### –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞

```typescript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–µ
await checkAndUnlockAchievements(userId)
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: { success, newAchievements[] }

// –í—Ä—É—á–Ω—É—é —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å (–∞–¥–º–∏–Ω—ã)
await unlockAchievement(userId, achievementId)
```

## üé® UI –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### AchievementsCard
–í–∏–¥–∂–µ—Ç –≤ health tracker (–ø—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞):
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç 3 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: "–ü–æ–ª—É—á–µ–Ω–æ X –∏–∑ Y" —Å –ø—Ä–æ—Ü–µ–Ω—Ç–æ–º
- –ö–Ω–æ–ø–∫–∞ –≤ —É–≥–ª—É –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–ø–∞–ø–∞
- –í–µ—Å—å –≤–∏–¥–∂–µ—Ç –∫–ª–∏–∫–∞–±–µ–ª–µ–Ω

### AchievementsPopup
–ü–æ–ø–∞–ø —Å–æ –≤—Å–µ–º–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è–º–∏:
- –§–∏–ª—å—Ç—Ä—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (–≤–∫–ª–∞–¥–∫–∏)
- –°–µ—Ç–∫–∞ 2-3 –∫–æ–ª–æ–Ω–∫–∏ (–∞–¥–∞–ø—Ç–∏–≤–Ω–æ)
- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –≤–≤–µ—Ä—Ö—É
- **–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ** - —Ü–≤–µ—Ç–Ω—ã–µ —Å –¥–∞—Ç–æ–π
- **–ù–µ–ø–æ–ª—É—á–µ–Ω–Ω—ã–µ** - –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ (opacity 0.4)
- **–°–µ–∫—Ä–µ—Ç–Ω—ã–µ** - –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∏–¥–Ω–æ, –æ–ø–∏—Å–∞–Ω–∏–µ "???"
- –ó–Ω–∞—á–æ–∫ –Ω–∞–≥—Ä–∞–¥—ã "üëü +50" –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö

### AchievementUnlockedToast
–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏:
- –ü–æ—è–≤–ª—è–µ—Ç—Å—è —Å–ø—Ä–∞–≤–∞ –≤–≤–µ—Ä—Ö—É
- –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è (slide + fade)
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–∫–æ–Ω–∫—É, –Ω–∞–∑–≤–∞–Ω–∏–µ, –Ω–∞–≥—Ä–∞–¥—É
- –ê–≤—Ç–æ–∑–∞–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
- –û—á–µ—Ä–µ–¥—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–µ—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

1. **–ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–Ω–µ–≤–Ω–∏–∫–∞** (`lib/actions/diary.ts`)
   - –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ `upsertDiaryEntry`
   - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `checkAndUnlockAchievements` —Ñ–æ–Ω–æ–≤–æ

2. **–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ç—Ä–µ–∫–µ—Ä–∞** (`app/dashboard/health-tracker/page.tsx`)
   - –í `useEffect` –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ —É—Å–ª–æ–≤–∏—è
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è—Ö

### –ë–æ–Ω—É—Å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

- –¢–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: `achievement`
- –í –∏—Å—Ç–æ—Ä–∏–∏ (`app/dashboard/bonuses/bonus-history.tsx`)
- –ò–∫–æ–Ω–∫–∞ —Ç—Ä–æ—Ñ–µ—è üèÜ
- –§–æ—Ä–º–∞—Ç: "–ó–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: [–Ω–∞–∑–≤–∞–Ω–∏–µ]"

## üîß –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ SQL

```sql
INSERT INTO achievements (
  title, 
  description, 
  category, 
  is_secret, 
  reward_amount, 
  icon, 
  color_class, 
  sort_order, 
  metadata
) VALUES (
  '–°—É–ø–µ—Ä–≥–µ—Ä–æ–π',
  '–í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ —Ü–µ–ª–∏ 30 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥',
  'consistency',
  true,
  500,
  'ü¶∏',
  'text-purple-500',
  100,
  '{"type": "perfect_streak", "value": 30}'
);
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É (–±—É–¥—É—â–µ–µ)

–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ: –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è CRUD –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π.

## üß™ –¢–∏–ø—ã —É—Å–ª–æ–≤–∏–π –≤ metadata

```typescript
// –°–µ—Ä–∏–∏
{ type: "streak_days", value: 7 }

// –ú–µ—Ç—Ä–∏–∫–∏ - –¥–Ω–µ–≤–Ω—ã–µ
{ type: "water_daily", value: 2500 }
{ type: "steps_daily", value: 10000 }
{ type: "sleep_daily", value: 8 }
{ type: "sleep_low", value: 4 }

// –ú–µ—Ç—Ä–∏–∫–∏ - –æ–±—â–∏–µ
{ type: "water_total", value: 100000 }
{ type: "steps_total", value: 1000000 }

// –ü—Ä–∏–≤—ã—á–∫–∏
{ type: "habit_complete_any", value: 1 }
{ type: "habits_all_streak", value: 5 }
{ type: "habit_completions", value: 100 }
{ type: "habits_created", value: 10 }

// –í–µ—Å
{ type: "weight_recorded", value: 1 }
{ type: "weight_streak", value: 7 }
{ type: "weight_goal_reached" }
{ type: "weight_maintain", value: 14 }

// –†–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å
{ type: "monthly_entries", value: 15 }
{ type: "total_entries", value: 100 }

// –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ
{ type: "perfect_day" }
{ type: "perfect_streak", value: 7 }
{ type: "water_goal_streak", value: 30 }
{ type: "energy_max", value: 10 }
{ type: "mood_great_streak", value: 14 }

// –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (–±—É–¥—É—â–µ–µ)
{ type: "workouts_completed", value: 1 }
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **RLS –≤–∫–ª—é—á–µ–Ω** –Ω–∞ –æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –≤—Å–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è (—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ
- –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ RPC —Ñ—É–Ω–∫—Ü–∏—é (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —á–∏—Ç–µ—Ä—Å—Ç–≤–æ)
- –ê–¥–º–∏–Ω—ã –º–æ–≥—É—Ç –≤—Ä—É—á–Ω—É—é –≤—ã–¥–∞–≤–∞—Ç—å —á–µ—Ä–µ–∑ `unlockAchievement`

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–¥–ª—è –±—É–¥—É—â–µ–π –∞–¥–º–∏–Ω–∫–∏)

```sql
-- –°–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
SELECT a.title, COUNT(ua.id) as unlock_count
FROM achievements a
LEFT JOIN user_achievements ua ON a.id = ua.achievement_id
GROUP BY a.id, a.title
ORDER BY unlock_count DESC;

-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
SELECT u.email, COUNT(ua.id) as achievement_count
FROM profiles u
LEFT JOIN user_achievements ua ON u.id = ua.user_id
GROUP BY u.id, u.email
ORDER BY achievement_count DESC
LIMIT 10;

-- –ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
SELECT 
  a.category,
  COUNT(DISTINCT a.id) as total_achievements,
  COUNT(DISTINCT ua.id) as unlocked_count,
  ROUND(COUNT(DISTINCT ua.id)::numeric / COUNT(DISTINCT a.id) * 100, 2) as unlock_percentage
FROM achievements a
LEFT JOIN user_achievements ua ON a.id = ua.achievement_id
GROUP BY a.category;
```

## üöÄ –ú–∏–≥—Ä–∞—Ü–∏—è

–§–∞–π–ª: `database/migrations/022_ADD_ACHIEVEMENTS_SYSTEM.sql`

–í—ã–ø–æ–ª–Ω–∏—Ç—å –≤ Supabase SQL Editor:
1. –°–æ–∑–¥–∞–µ—Ç enum —Ç–∏–ø—ã
2. –°–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—ã —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏
3. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç RLS –ø–æ–ª–∏—Ç–∏–∫–∏
4. –°–æ–∑–¥–∞–µ—Ç RPC —Ñ—É–Ω–∫—Ü–∏—é —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
5. –ó–∞–ø–æ–ª–Ω—è–µ—Ç 37 –±–∞–∑–æ–≤—ã–º–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è–º–∏

## üéØ Roadmap

### –§–∞–∑–∞ 1 (–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ) ‚úÖ
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –º–∏–≥—Ä–∞—Ü–∏–∏
- ‚úÖ Server actions
- ‚úÖ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–≤–∏–¥–∂–µ—Ç, –ø–æ–ø–∞–ø, toast)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–æ–Ω—É—Å–∞–º–∏

### –§–∞–∑–∞ 2 (–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- [ ] –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è–º–∏
- [ ] –ü—Ä–æ–≥—Ä–µ—Å—Å –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è (–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å 7/14 –¥–Ω–µ–π)
- [ ] –†–µ–¥–∫–æ—Å—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π (–æ–±—ã—á–Ω—ã–µ/—Ä–µ–¥–∫–∏–µ/–ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ)
- [ ] –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (% –∏–≥—Ä–æ–∫–æ–≤ –ø–æ–ª—É—á–∏–ª–∏)
- [ ] –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∑–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏

### –§–∞–∑–∞ 3 (–ò–¥–µ–∏)
- [ ] –¶–µ–ø–æ—á–∫–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π (—Ç—Ä–µ–±—É—é—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–µ)
- [ ] –°–µ–∑–æ–Ω–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
- [ ] –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è (—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–∑—å—è–º–∏)
- [ ] –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è-—á–µ–ª–ª–µ–Ω–¥–∂–∏ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏)

## üêõ –û—Ç–ª–∞–¥–∫–∞

```typescript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
import { checkAndUnlockAchievements } from '@/lib/actions/achievements'

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
const result = await checkAndUnlockAchievements('user-id')
console.log(result)

// –í Supabase SQL
SELECT * FROM achievements WHERE is_secret = true;
SELECT * FROM user_achievements WHERE user_id = 'user-id';
```

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –û–¥–Ω–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –Ω–æ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç UI
- –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ, –Ω–æ —Å –∑–∞–≥–ª—É—à–∫–∞–º–∏
- –ù–∞–≥—Ä–∞–¥—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ –±–æ–Ω—É—Å–Ω—ã–π —Å—á–µ—Ç
- –ò—Å—Ç–æ—Ä–∏—è –±–æ–Ω—É—Å–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫ "–ó–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: [–Ω–∞–∑–≤–∞–Ω–∏–µ]"

---

**–í–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã:** 1.0  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** –Ø–Ω–≤–∞—Ä—å 2026  
**–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:** MargoFitness Team

