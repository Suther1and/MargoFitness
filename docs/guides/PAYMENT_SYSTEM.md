# üí≥ –ü–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ MargoFitness

## üéâ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ÆKassa (–Ø–Ω–¥–µ–∫—Å.–ö–∞—Å—Å–∞) - **—Ç–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã**
- ‚úÖ **Embedded –≤–∏–¥–∂–µ—Ç** - –æ–ø–ª–∞—Ç–∞ –ø—Ä—è–º–æ –Ω–∞ —Å–∞–π—Ç–µ
- ‚úÖ **Redirect –≤–∞—Ä–∏–∞–Ω—Ç** - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –Æ–ö–∞—Å—Å—É
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ webhook –ø–æ–¥–ø–∏—Å–∏** (HMAC-SHA256)
- ‚úÖ –†–µ–∫—É—Ä—Ä–µ–Ω—Ç–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏ (–∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ)
- ‚úÖ 3 —É—Ä–æ–≤–Ω—è –ø–æ–¥–ø–∏—Å–∫–∏ (Basic, Pro, Elite)
- ‚úÖ 4 –ø–µ—Ä–∏–æ–¥–∞ –ø–æ–¥–ø–∏—Å–∫–∏ (1, 3, 6, 12 –º–µ—Å—è—Ü–µ–≤)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫–∏–¥–∫–∏ (5%, 10%, 15%)
- ‚úÖ –ü—Ä–∏–≤—è–∑–∫–∞ –∫–∞—Ä—Ç –¥–ª—è –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–æ–π –∏–∑ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞
- ‚úÖ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∞–º–∏
- ‚úÖ Cron job –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–æ–¥–ª–µ–Ω–∏—è
- ‚úÖ Mock —Ä–µ–∂–∏–º –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- ‚úÖ Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (Resend) - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ, –æ–ø–ª–∞—Ç–∞, –∞–ø–≥—Ä–µ–π–¥

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
```
database/migrations/
‚îú‚îÄ‚îÄ 008_ADD_YOOKASSA_INTEGRATION.sql  # –û—Å–Ω–æ–≤–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ INSERT_PRODUCTS_ONLY.sql          # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
‚îú‚îÄ‚îÄ README_008.md                     # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ FIX_PRODUCTS_RLS.sql              # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ RLS –ø–æ–ª–∏—Ç–∏–∫
```

### API Routes
```
app/api/
‚îú‚îÄ‚îÄ payments/
‚îÇ   ‚îú‚îÄ‚îÄ create/route.ts              # –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
‚îÇ   ‚îú‚îÄ‚îÄ webhook/route.ts             # –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç –ÆKassa
‚îÇ   ‚îú‚îÄ‚îÄ toggle-auto-renew/route.ts   # –í–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ cancel-full/route.ts         # –ü–æ–ª–Ω–∞—è –æ—Ç–º–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ upgrade/route.ts             # –ê–ø–≥—Ä–µ–π–¥ –ø–æ–¥–ø–∏—Å–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ cancel-subscription/route.ts # –û—Ç–º–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ transactions/route.ts        # –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
‚îú‚îÄ‚îÄ products/
‚îÇ   ‚îî‚îÄ‚îÄ by-duration/route.ts         # –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø–æ –ø–µ—Ä–∏–æ–¥—É
‚îî‚îÄ‚îÄ cron/
    ‚îî‚îÄ‚îÄ renew-subscriptions/route.ts # –ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ (cron job)
```

### –°–µ—Ä–≤–∏—Å—ã
```
lib/services/
‚îú‚îÄ‚îÄ yookassa.ts              # –ö–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API –ÆKassa
‚îú‚îÄ‚îÄ subscription-manager.ts  # –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–¥–ø–∏—Å–æ–∫ (–ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏)
‚îî‚îÄ‚îÄ email.ts                 # Email —Å–µ—Ä–≤–∏—Å (Resend) —Å —à–∞–±–ª–æ–Ω–∞–º–∏
```

### UI –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
```
app/
‚îú‚îÄ‚îÄ payment/[productId]/
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx             # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–ø–ª–∞—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ payment-button.tsx   # –ö–Ω–æ–ø–∫–∞ –æ–ø–ª–∞—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ yookassa-widget.tsx  # Embedded –≤–∏–¥–∂–µ—Ç –Æ–ö–∞—Å—Å—ã
‚îÇ   ‚îî‚îÄ‚îÄ promo-input.tsx      # –ü–æ–ª–µ –¥–ª—è –ø—Ä–æ–º–æ–∫–æ–¥–∞
‚îú‚îÄ‚îÄ dashboard/
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                    # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–∞—à–±–æ—Ä–¥–∞ (—Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç)
‚îÇ   ‚îú‚îÄ‚îÄ health-tracker-content.tsx  # Health Tracker (–∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç)
‚îÇ   ‚îî‚îÄ‚îÄ health-tracker/
‚îÇ       ‚îî‚îÄ‚îÄ components/
‚îÇ           ‚îú‚îÄ‚îÄ desktop-profile-card.tsx       # –ö–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è (–¥–µ—Å–∫—Ç–æ–ø)
‚îÇ           ‚îú‚îÄ‚îÄ desktop-subscription-card.tsx  # –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ (–¥–µ—Å–∫—Ç–æ–ø)
‚îÇ           ‚îú‚îÄ‚îÄ desktop-bonus-card.tsx         # –ö–∞—Ä—Ç–æ—á–∫–∞ –±–æ–Ω—É—Å–æ–≤ (–¥–µ—Å–∫—Ç–æ–ø)
‚îÇ           ‚îî‚îÄ‚îÄ profile-tab.tsx                # –í–∫–ª–∞–¥–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è (–º–æ–±–∏–ª—å–Ω–∞—è)
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ profile-edit-dialog.tsx           # –ú–æ–¥–∞–ª–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
‚îÇ   ‚îú‚îÄ‚îÄ subscription-renewal-modal.tsx    # –ú–æ–¥–∞–ª–∫–∞ –ø—Ä–æ–¥–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ subscription-upgrade-modal.tsx    # –ú–æ–¥–∞–ª–∫–∞ –∞–ø–≥—Ä–µ–π–¥–∞ –ø–æ–¥–ø–∏—Å–∫–∏
‚îî‚îÄ‚îÄ admin/users/
    ‚îú‚îÄ‚îÄ page.tsx             # –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    ‚îî‚îÄ‚îÄ cancel-subscription-button.tsx # –ö–Ω–æ–ø–∫–∞ –æ—Ç–º–µ–Ω—ã –¥–ª—è –∞–¥–º–∏–Ω–∞
```

---

## üîÑ –§–ª–æ—É —Ä–∞–±–æ—Ç—ã

### 1. –ü–æ–∫—É–ø–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí /
              ‚Üì
    –í—ã–±–æ—Ä –ø–µ—Ä–∏–æ–¥–∞ (1/3/6/12 –º–µ—Å)
              ‚Üì
    –í—ã–±–æ—Ä —Ç–∞—Ä–∏—Ñ–∞ (Basic/Pro/Elite)
              ‚Üì
    /payment/[productId]
              ‚Üì
    –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç—ã
              ‚Üì
    POST /api/payments/create
              ‚Üì
    –ü–ª–∞—Ç–µ–∂ —Å–æ–∑–¥–∞–Ω ‚Üí paymentId
              ‚Üì
    –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ –Æ–ö–∞—Å—Å—É
              ‚Üì
    POST /api/payments/webhook
              ‚Üì
    –ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ ‚úÖ
              ‚Üì
    Redirect ‚Üí /dashboard
```

### 2. –ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ

```
Cron Job (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ 02:00 UTC)
              ‚Üì
GET /api/cron/renew-subscriptions
              ‚Üì
    –ü–æ–∏—Å–∫ –ø–æ–¥–ø–∏—Å–æ–∫ –¥–ª—è –ø—Ä–æ–¥–ª–µ–Ω–∏—è:
    - next_billing_date = —Å–µ–≥–æ–¥–Ω—è
    - auto_renew_enabled = true
    - payment_method_id –Ω–µ –ø—É—Å—Ç–æ–π
              ‚Üì
    –î–ª—è –∫–∞–∂–¥–æ–π –ø–æ–¥–ø–∏—Å–∫–∏:
              ‚Üì
    autoRenewSubscription(userId)
              ‚Üì
    –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∫—É—Ä—Ä–µ–Ω—Ç–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞
              ‚Üì
    –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞—Ç –ø–æ–¥–ø–∏—Å–∫–∏
              ‚Üì
    –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
              ‚Üì
    –ü–æ–¥–ø–∏—Å–∫–∞ –ø—Ä–æ–¥–ª–µ–Ω–∞ ‚úÖ
```

### 3. –ù–µ—É–¥–∞—á–Ω–æ–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ

```
1-—è –ø–æ–ø—ã—Ç–∫–∞ –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å
              ‚Üì
failed_payment_attempts = 1
              ‚Üì
    Retry –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å
              ‚Üì
2-—è –ø–æ–ø—ã—Ç–∫–∞ –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å
              ‚Üì
failed_payment_attempts = 2
              ‚Üì
    Downgrade –Ω–∞ Free —Ç–∞—Ä–∏—Ñ
              ‚Üì
subscription_tier = 'free'
subscription_status = 'inactive'
```

---

## üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ `profiles`

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `payment_method_id` | TEXT | ID —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –∫–∞—Ä—Ç—ã |
| `auto_renew_enabled` | BOOLEAN | –í–∫–ª—é—á–µ–Ω–æ –ª–∏ –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ |
| `subscription_duration_months` | INTEGER | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏ |
| `next_billing_date` | TIMESTAMP | –î–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–ø–∏—Å–∞–Ω–∏—è |
| `failed_payment_attempts` | INTEGER | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ |
| `last_payment_date` | TIMESTAMP | –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–ª–∞—Ç–µ–∂–∞ |

### –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `payment_transactions`

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | UUID | ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ |
| `user_id` | UUID | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `yookassa_payment_id` | TEXT | ID –ø–ª–∞—Ç–µ–∂–∞ –≤ –ÆKassa |
| `status` | TEXT | –°—Ç–∞—Ç—É—Å (pending/succeeded/canceled/failed) |
| `amount` | NUMERIC | –°—É–º–º–∞ |
| `currency` | TEXT | –í–∞–ª—é—Ç–∞ (RUB) |
| `payment_type` | TEXT | –¢–∏–ø (initial/recurring/upgrade/one_time/renewal) |
| `payment_method_id` | TEXT | ID —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã |
| `error_message` | TEXT | –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ |
| `metadata` | JSONB | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ |

### –ü—Ä–æ–¥—É–∫—Ç—ã –ø–æ–¥–ø–∏—Å–æ–∫

12 –ø—Ä–æ–¥—É–∫—Ç–æ–≤: 3 —Ç–∞—Ä–∏—Ñ–∞ √ó 4 –ø–µ—Ä–∏–æ–¥–∞

| –¢–∞—Ä–∏—Ñ | 1 –º–µ—Å | 3 –º–µ—Å | 6 –º–µ—Å | 12 –º–µ—Å |
|-------|-------|-------|-------|--------|
| Basic | 3999‚ÇΩ | 11397‚ÇΩ (-5%) | 21594‚ÇΩ (-10%) | 40791‚ÇΩ (-15%) |
| Pro   | 4499‚ÇΩ | 12822‚ÇΩ (-5%) | 24294‚ÇΩ (-10%) | 45891‚ÇΩ (-15%) |
| Elite | 9999‚ÇΩ | 28497‚ÇΩ (-5%) | 53994‚ÇΩ (-10%) | 101991‚ÇΩ (-15%) |

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ `.env.local`:

```bash
# Supabase (—É–∂–µ –µ—Å—Ç—å)
NEXT_PUBLIC_SUPABASE_URL=...
NEXT_PUBLIC_SUPABASE_ANON_KEY=...
SUPABASE_SERVICE_ROLE_KEY=...

# –ÆKassa (—Ç–µ—Å—Ç–æ–≤—ã–π –º–∞–≥–∞–∑–∏–Ω)
YOOKASSA_SHOP_ID=1236232
YOOKASSA_SECRET_KEY=test_TVB8TaaAmH5opZrt-O4xicPqgoIYnUSCTIWtIG5kR4E
NEXT_PUBLIC_YOOKASSA_RETURN_URL=http://localhost:3000/dashboard?payment=success
YOOKASSA_WEBHOOK_SECRET=your_webhook_secret_from_yookassa

# Cron Job
CRON_SECRET=dev_secret_key_12345

# Email (Resend)
RESEND_API_KEY=re_your_api_key
EMAIL_FROM=MargoFitness <onboarding@resend.dev>
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

### 2. –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ Supabase SQL Editor:

```sql
-- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞:
database/migrations/008_ADD_YOOKASSA_INTEGRATION.sql
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
npm install @radix-ui/react-switch @radix-ui/react-checkbox
```

---

## üöÄ Deploy –≤ Production

### Checklist:

- [ ] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ –ò–ü
- [ ] –ü–æ–¥–∫–ª—é—á–∏—Ç—å –ÆKassa ([yookassa.ru](https://yookassa.ru/))
- [ ] –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ `YOOKASSA_SHOP_ID` –∏ `YOOKASSA_SECRET_KEY`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏—Ö –≤ Vercel Environment Variables
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Webhook URL –≤ –ÆKassa: `https://your-domain.com/api/payments/webhook`
- [ ] –ü–æ–ª—É—á–∏—Ç—å `YOOKASSA_WEBHOOK_SECRET` –∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ Vercel
- [ ] –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å `CRON_SECRET` –∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ Vercel
- [ ] –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ Vercel
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Cron Job –∑–∞–ø—É—Å—Ç–∏–ª—Å—è (Vercel Dashboard ‚Üí Cron)
- [ ] –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ç–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ webhook —Å—Ä–∞–±–æ—Ç–∞–ª
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∞—Å—å

### –í–∞–∂–Ω–æ –≤ production:

1. **‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ webhook —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞:**
   - –§—É–Ω–∫—Ü–∏—è `verifyWebhookSignature()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç HMAC-SHA256
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å –≤ production —Ä–µ–∂–∏–º–µ
   - –ó–∞—â–∏—Ç–∞ –æ—Ç timing attacks

2. **–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –±–æ–µ–≤—ã–µ –∫–ª—é—á–∏:**
   - –ó–∞–º–µ–Ω–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–∏ (—Å `test_` –ø—Ä–µ—Ñ–∏–∫—Å–æ–º) –Ω–∞ –±–æ–µ–≤—ã–µ
   - –û–±–Ω–æ–≤–∏—Ç—å `YOOKASSA_SHOP_ID` –∏ `YOOKASSA_SECRET_KEY`
   - –û–±–Ω–æ–≤–∏—Ç—å webhook URL –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –Æ–ö–∞—Å—Å—ã

3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - Vercel Analytics
   - Error tracking (Sentry)
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–µ—É–¥–∞—á–Ω—ã—Ö cron jobs

---

## ‚úÖ –ù–µ–¥–∞–≤–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### ‚ö° –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Æ–ö–∞—Å—Å—ã
- ‚úÖ **Embedded –≤–∏–¥–∂–µ—Ç** - –æ–ø–ª–∞—Ç–∞ –ø—Ä—è–º–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–∞–π—Ç–∞
- ‚úÖ **Redirect –≤–∞—Ä–∏–∞–Ω—Ç** - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –Æ–ö–∞—Å—Å—ã
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ webhook –ø–æ–¥–ø–∏—Å–∏** (HMAC-SHA256)
- ‚úÖ **–¢–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–∏** –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ —Ä–∞–±–æ—Ç–µ

### Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Resend –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ email
- ‚úÖ –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø–∏—Å—å–º–æ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –∞–ø–≥—Ä–µ–π–¥–µ –ø–æ–¥–ø–∏—Å–∫–∏
- ‚úÖ –ö—Ä–∞—Å–∏–≤—ã–µ HTML —à–∞–±–ª–æ–Ω—ã –ø–∏—Å–µ–º

### –ê–ø–≥—Ä–µ–π–¥ –ø–æ–¥–ø–∏—Å–∫–∏
- ‚úÖ –£–º–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –¥–Ω–µ–π
- ‚úÖ UI –¥–∏–∞–ª–æ–≥ –¥–ª—è –∞–ø–≥—Ä–µ–π–¥–∞ –≤ Dashboard
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ (–Ω–µ–ª—å–∑—è –∫—É–ø–∏—Ç—å —Ç–æ—Ç –∂–µ –∏–ª–∏ –±–æ–ª–µ–µ –Ω–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å)
- ‚úÖ Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –∞–ø–≥—Ä–µ–π–¥–µ —Å –¥–µ—Ç–∞–ª—è–º–∏

### –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
- ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
- ‚úÖ –û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞ –∏ —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫
- ‚úÖ –í—ã—Ä—É—á–∫–∞ –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –ø–æ —É—Ä–æ–≤–Ω—è–º
- ‚úÖ –ö–æ–Ω–≤–µ—Ä—Å–∏—è –∏ –Ω–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

