# ‚ö° –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å OAuth

## üö® Google –ø–µ—Ä–µ–∫–∏–¥—ã–≤–∞–µ—Ç –Ω–∞ localhost

### –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Google –ø–µ—Ä–µ–∫–∏–¥—ã–≤–∞–µ—Ç –Ω–∞ `http://localhost:3000` –≤–º–µ—Å—Ç–æ production –¥–æ–º–µ–Ω–∞.

### –†–µ—à–µ–Ω–∏–µ (2 –º–∏–Ω—É—Ç—ã)

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env.local`:**
```env
NEXT_PUBLIC_SITE_URL=https://yourdomain.com
```

2. **–í Vercel (–µ—Å–ª–∏ –¥–µ–ø–ª–æ–∏—Ç–µ —Ç—É–¥–∞):**
   - Settings ‚Üí Environment Variables
   - –î–æ–±–∞–≤—å—Ç–µ: `NEXT_PUBLIC_SITE_URL=https://yourdomain.com`
   - **Redeploy**

3. **–í Supabase Dashboard:**
   - Authentication ‚Üí URL Configuration
   - **Site URL:** `https://yourdomain.com`
   - **Redirect URLs:** –¥–æ–±–∞–≤—å—Ç–µ `https://yourdomain.com/**`

4. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ:**
```bash
npm run dev
```

‚úÖ **–ì–æ—Ç–æ–≤–æ!** Google —Ç–µ–ø–µ—Ä—å –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

---

## üö® –Ø–Ω–¥–µ–∫—Å –ø–∏—à–µ—Ç "invalid_scope"

### –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≤–æ–π—Ç–∏ —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç: "–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–µ –¥–æ—Å—Ç—É–ø—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —É –¥–∞–Ω–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"

### –†–µ—à–µ–Ω–∏–µ (—É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–¥–µ!)

**–û–±–Ω–æ–≤–∏—Ç–µ —Ñ–∞–π–ª** (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ):
- `app/api/auth/yandex/init/route.ts`
- Scope **—É–±—Ä–∞–Ω** –∏–ª–∏ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω

### –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–û—Ç–∫—Ä–æ–π—Ç–µ [–Ø–Ω–¥–µ–∫—Å OAuth Console](https://oauth.yandex.ru/)**
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:** –ù–ï –≤—ã–±–∏—Ä–∞–π—Ç–µ –Ω–∏—á–µ–≥–æ
4. **Callback URI:** `https://yourdomain.com/api/auth/yandex/callback`
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

6. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env.local`:**
```env
YANDEX_CLIENT_ID=–≤–∞—à_client_id
YANDEX_CLIENT_SECRET=–≤–∞—à_secret
NEXT_PUBLIC_SITE_URL=https://yourdomain.com
```

‚úÖ **–ì–æ—Ç–æ–≤–æ!** –Ø–Ω–¥–µ–∫—Å OAuth –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å.

---

## üö® Telegram –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ

### –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ `?ref=CODE` —á–µ—Ä–µ–∑ Telegram —Ä–µ—Ñ–µ—Ä–∞–ª –Ω–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è.

### –†–µ—à–µ–Ω–∏–µ (—É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!)

–ö–æ–¥ **—É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω** –∏ –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!

### –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–°–æ–∑–¥–∞–π—Ç–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É:**
   - –í–æ–π–¥–∏—Ç–µ –≤ Dashboard
   - –ë–æ–Ω—É—Å—ã ‚Üí –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É: `https://yourdomain.com/auth?ref=ABC123`

2. **–û—Ç–∫—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫—É –≤ –Ω–æ–≤–æ–º –±—Ä–∞—É–∑–µ—Ä–µ (–∏–Ω–∫–æ–≥–Ω–∏—Ç–æ):**
   - –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å: "üéÅ –í—ã –ø—Ä–∏–≥–ª–∞—à–µ–Ω—ã! –ü–æ–ª—É—á–∏—Ç–µ 250 —à–∞–≥–æ–≤"

3. **–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ Telegram:**
   - –ù–∞–∂–º–∏—Ç–µ "Telegram"
   - –í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Telegram

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–æ–Ω—É—Å—ã:**
   - Dashboard ‚Üí –ë–æ–Ω—É—Å—ã
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: 500 —à–∞–≥–æ–≤ (250 –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö + 250 –∑–∞ —Ä–µ—Ñ–µ—Ä–∞–ª)

### –ï—Å–ª–∏ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç:

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞:**
```javascript
// –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥
localStorage.getItem('telegram_ref_code')
```

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network tab:**
- –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∫ `/api/auth/telegram`
- –í —Ç–µ–ª–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å: `"ref_code": "ABC123"`

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞:**
```bash
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –ª–æ–≥–∞—Ö
[Telegram Auth] hasRefCode: true
[Telegram Auth] refCode: ABC123
[Telegram Auth] Processing referral code: ABC123
```

‚úÖ **–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ —ç—Ç–æ** - —Ä–µ—Ñ–µ—Ä–∞–ª —Ä–∞–±–æ—Ç–∞–µ—Ç!

---

## üîç –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
console.log('Site URL:', process.env.NEXT_PUBLIC_SITE_URL)
console.log('Supabase URL:', process.env.NEXT_PUBLIC_SUPABASE_URL)
console.log('Telegram Bot:', process.env.NEXT_PUBLIC_TELEGRAM_BOT_NAME)
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
Site URL: https://yourdomain.com
Supabase URL: https://your-project.supabase.co
Telegram Bot: margofitness_auth_bot
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Supabase –Ω–∞—Å—Ç—Ä–æ–µ–∫

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Supabase Dashboard](https://app.supabase.com)
2. **Authentication ‚Üí URL Configuration**
3. **Site URL:** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `https://yourdomain.com` (–ù–ï localhost!)
4. **Redirect URLs:** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `https://yourdomain.com/**`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Google OAuth

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Google Cloud Console](https://console.cloud.google.com/)
2. **APIs & Services ‚Üí Credentials**
3. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à OAuth Client
4. **Authorized redirect URIs:** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å
   ```
   https://YOUR_PROJECT.supabase.co/auth/v1/callback
   ```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ø–Ω–¥–µ–∫—Å OAuth

1. –û—Ç–∫—Ä–æ–π—Ç–µ [–Ø–Ω–¥–µ–∫—Å OAuth Console](https://oauth.yandex.ru/)
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. **Callback URI:** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å
   ```
   https://yourdomain.com/api/auth/yandex/callback
   ```
4. **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:** –ù–ï –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—ã–±—Ä–∞–Ω—ã

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–ª–æ, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **–õ–æ–≥–∏ Supabase:**
   - Dashboard ‚Üí Logs ‚Üí Auth Logs
   - –°–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –æ—à–∏–±–∫–∏

2. **–õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞:**
   - –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≥–¥–µ –∑–∞–ø—É—â–µ–Ω `npm run dev`
   - –ò—â–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ —Å `[Callback]`, `[Yandex]`, `[Telegram]`

3. **–ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞:**
   - F12 ‚Üí Console
   - F12 ‚Üí Network tab
   - –ò—â–∏—Ç–µ –æ—à–∏–±–∫–∏

4. **–§–∞–π–ª—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
   - `components/oauth-buttons.tsx` - Google OAuth
   - `app/api/auth/yandex/init/route.ts` - –Ø–Ω–¥–µ–∫—Å scope
   - `components/telegram-login-widget.tsx` - Telegram —Ä–µ—Ñ–µ—Ä–∞–ª

---

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 25 –¥–µ–∫–∞–±—Ä—è 2025  
**–í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:** ‚úÖ

