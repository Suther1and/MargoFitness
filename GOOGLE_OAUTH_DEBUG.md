# üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Google OAuth

## –ü—Ä–æ–±–ª–µ–º–∞
–û–∫–Ω–æ Google –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∏ –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç.

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –£–ª—É—á—à–µ–Ω Callback Route
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è, –µ—Å–ª–∏ —Ç—Ä–∏–≥–≥–µ—Ä –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–º

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏–∏ React
- –î–æ–±–∞–≤–ª–µ–Ω `suppressHydrationWarning` –≤ `app/layout.tsx`
- –≠—Ç–æ —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –æ—à–∏–±–∫—É —Å `lang="ru"` –≤ –∫–æ–Ω—Å–æ–ª–∏

## üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Supabase

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Redirect URLs

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Supabase Dashboard** ‚Üí –≤–∞—à –ø—Ä–æ–µ–∫—Ç
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Authentication** ‚Üí **URL Configuration**
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ **Redirect URLs** –¥–æ–±–∞–≤–ª–µ–Ω—ã:
   ```
   http://localhost:3000/auth/callback
   http://localhost:3000/**
   ```
4. –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–æ–¥–∞–∫—à–Ω:
   ```
   https://–≤–∞—à-–¥–æ–º–µ–Ω.com/auth/callback
   https://–≤–∞—à-–¥–æ–º–µ–Ω.com/**
   ```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Google OAuth Provider

1. –í **Supabase Dashboard** ‚Üí **Authentication** ‚Üí **Providers**
2. –ù–∞–π–¥–∏—Ç–µ **Google** –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
   - ‚úÖ **Enabled** –≤–∫–ª—é—á–µ–Ω
   - ‚úÖ **Client ID** –∑–∞–ø–æ–ª–Ω–µ–Ω
   - ‚úÖ **Client Secret** –∑–∞–ø–æ–ª–Ω–µ–Ω

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Google Cloud Console

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Google Cloud Console](https://console.cloud.google.com/)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **APIs & Services** ‚Üí **Credentials**
3. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à OAuth 2.0 Client ID
4. –í —Ä–∞–∑–¥–µ–ª–µ **Authorized redirect URIs** –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å:
   ```
   https://–≤–∞—à-–ø—Ä–æ–µ–∫—Ç.supabase.co/auth/v1/callback
   http://localhost:3000/auth/callback (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
   ```

   **–í–ê–ñ–ù–û**: URL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–º–µ–Ω–Ω–æ `https://–≤–∞—à-–ø—Ä–æ–µ–∫—Ç.supabase.co/auth/v1/callback`, –∞ –ù–ï –≤–∞—à –ª–æ–∫–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å!

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

–ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Google –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–∏:
```
[Callback] Received callback with code: YES
[Callback] Session created for user: <user-id> <email>
[Callback] Profile check: EXISTS/NOT FOUND
[Callback] Profile created successfully: <profile-data>
[Callback] Redirecting to: /dashboard
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ Next.js

–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ, –≥–¥–µ –∑–∞–ø—É—â–µ–Ω `npm run dev`, –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ª–æ–≥–∏:
```
[Callback] Received callback with code: YES
[Callback] Session created for user: ...
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Supabase Dashboard** ‚Üí **Table Editor**
2. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É **profiles**
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—è–≤–∏–ª–∞—Å—å –∑–∞–ø–∏—Å—å —Å –≤–∞—à–∏–º email

## üêõ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "Session exchange failed"
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–≤–µ—Ä–Ω—ã–π callback URL –≤ Supabase
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Redirect URLs –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Supabase (—Å–º. –®–∞–≥ 1)

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ü—Ä–æ—Ñ–∏–ª—å –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è
**–ü—Ä–∏—á–∏–Ω–∞**: –¢—Ä–∏–≥–≥–µ—Ä `handle_new_user()` –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏–ª–∏ RLS –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ
**–†–µ—à–µ–Ω–∏–µ**: 
- Callback route —Ç–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ –ª–æ–≥–∞—Ö –µ—Å—Ç—å `[Callback] Profile created successfully`

### –ü—Ä–æ–±–ª–µ–º–∞ 3: "Unauthorized" –ø—Ä–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–µ –Ω–∞ dashboard
**–ü—Ä–∏—á–∏–Ω–∞**: Cookies –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞–º–∏
**–†–µ—à–µ–Ω–∏–µ**: 
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `SameSite=Lax` –¥–ª—è cookies
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–æ–º–µ–Ω—ã —Å–æ–≤–ø–∞–¥–∞—é—Ç

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –¢—Ä–∏–≥–≥–µ—Ä –Ω–µ —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
**–ü—Ä–∏—á–∏–Ω–∞**: –¢—Ä–∏–≥–≥–µ—Ä –º–æ–∂–µ—Ç –Ω–µ –∏–º–µ—Ç—å –ø—Ä–∞–≤ –∏–ª–∏ –Ω–µ –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω
**–†–µ—à–µ–Ω–∏–µ**: 
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Supabase SQL Editor:
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–∞
SELECT * FROM pg_trigger WHERE tgname = 'on_auth_user_created';

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏ —Ç—Ä–∏–≥–≥–µ—Ä–∞
SELECT * FROM pg_proc WHERE proname = 'handle_new_user';
```

2. –ï—Å–ª–∏ —Ç—Ä–∏–≥–≥–µ—Ä–∞ –Ω–µ—Ç, —Å–æ–∑–¥–∞–π—Ç–µ –µ–≥–æ –∑–∞–Ω–æ–≤–æ:
```sql
CREATE OR REPLACE FUNCTION handle_new_user()
RETURNS TRIGGER AS $$
BEGIN
  INSERT INTO public.profiles (id, email, role, subscription_status, subscription_tier)
  VALUES (
    NEW.id,
    NEW.email,
    'user',
    'inactive',
    'free'
  );
  RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

DROP TRIGGER IF EXISTS on_auth_user_created ON auth.users;

CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW
  EXECUTE FUNCTION handle_new_user();
```

## üìù –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **–û—á–∏—Å—Ç–∏—Ç–µ –±—Ä–∞—É–∑–µ—Ä**
   - –û—Ç–∫—Ä–æ–π—Ç–µ Dev Tools (F12)
   - Application ‚Üí Clear Site Data
   - –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∂–∏–º –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**
   ```bash
   npm run dev
   ```

3. **–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞** (F12 ‚Üí Console)

4. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞**
   ```
   http://localhost:3000/auth/login
   ```

5. **–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "Google"**
   - –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –≤ Google
   - –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –¥–æ—Å—Ç—É–ø

6. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏**
   - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è `[Callback] ...`
   - –ï—Å–ª–∏ –∏—Ö –Ω–µ—Ç, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª Next.js

7. **–ï—Å–ª–∏ –≤–∞—Å —Ä–µ–¥–∏—Ä–µ–∫—Ç–Ω—É–ª–æ –Ω–∞ `/dashboard` - ‚úÖ —É—Å–ø–µ—Ö!**
   - –ï—Å–ª–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–Ω—É–ª–æ –Ω–∞ `/auth/login` - —Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏ –≤—Ä—É—á–Ω—É—é

–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `/dashboard` –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```javascript
const supabase = createClient()
const { data, error } = await supabase.auth.getUser()
console.log('User:', data.user)
console.log('Error:', error)
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –≤ –±–∞–∑–µ

```sql
-- –í Supabase SQL Editor
SELECT * FROM profiles WHERE email = '–≤–∞—à@email.com';
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ RLS –ø–æ–ª–∏—Ç–∏–∫

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–∏—Ç–∏–∫ –¥–ª—è profiles
SELECT * FROM pg_policies WHERE tablename = 'profiles';
```

## üìû –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç

1. –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ —Å –æ—à–∏–±–∫–∞–º–∏
2. –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ Next.js —Å –ª–æ–≥–∞–º–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Supabase Dashboard ‚Üí Authentication ‚Üí Users, —Å–æ–∑–¥–∞–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Supabase Dashboard ‚Üí Table Editor ‚Üí profiles, —Å–æ–∑–¥–∞–µ—Ç—Å—è –ª–∏ –ø—Ä–æ—Ñ–∏–ª—å

---

**–ê–≤—Ç–æ—Ä**: AI Assistant  
**–î–∞—Ç–∞**: 23.12.2025  
**–í–µ—Ä—Å–∏—è**: 1.0

