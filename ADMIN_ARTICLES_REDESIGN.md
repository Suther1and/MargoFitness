# Редизайн админки статей - Инструкция по деплою

## Применение миграций БД

Перед использованием обновленной админки статей необходимо применить SQL миграцию к базе данных.

### Миграция

**database/20260222_add_article_admin_fields.sql** - Полная миграция, которая включает:
- Добавление поля `view_count` для трекинга просмотров статей
- Создание функции `increment_article_view()` для безопасного инкремента просмотров
- Все остальные поля для управления статьями (display_status, sort_order, tags, is_new, is_updated)

### Способы применения

#### Вариант 1: Через Supabase Dashboard

1. Откройте [Supabase Dashboard](https://supabase.com/dashboard)
2. Перейдите в ваш проект
3. Откройте SQL Editor (боковая панель)
4. Скопируйте содержимое файла `database/20260222_add_article_admin_fields.sql` и выполните
5. Убедитесь, что миграция выполнена успешно

#### Вариант 2: Через Supabase CLI (если настроен)

```bash
supabase db push
```

### Проверка применения миграций

Выполните следующий SQL запрос для проверки:

```sql
-- Проверка наличия поля view_count
SELECT column_name, data_type, column_default 
FROM information_schema.columns 
WHERE table_name = 'articles' AND column_name = 'view_count';

-- Проверка наличия функции increment_article_view
SELECT routine_name 
FROM information_schema.routines 
WHERE routine_name = 'increment_article_view';

-- Проверка индекса
SELECT indexname 
FROM pg_indexes 
WHERE tablename = 'articles' AND indexname = 'idx_articles_view_count';
```

Должны вернуться строки для всех трех запросов.

## Что изменилось

### 1. UI/UX улучшения
- ✅ Удалена подсказка "Логика публикации"
- ✅ Оптимизированы карточки статистики (3 компактные карточки вместо 5)
- ✅ Компактные бейджи NEW/UPDATED
- ✅ Удалена нефункциональная кнопка с замком

### 2. Drag & Drop для изменения порядка
- ✅ Перетаскивание статей мышью с визуальной обратной связью
- ✅ Улучшенные стрелки вверх/вниз как альтернативный способ
- ✅ Иконка захвата (⋮⋮) для удобного перетаскивания

### 3. Улучшенные элементы управления
- ✅ Dropdown для уровней доступа с цветовой индикацией
- ✅ Исправлен баг с незакрывающимся окном тегов
- ✅ Добавлен backdrop для закрытия окна тегов при клике вне его

### 4. Система просмотров статей
- ✅ Добавлено поле `view_count` в БД
- ✅ Колонка "Просмотры" в таблице админки
- ✅ API функция `incrementArticleView()` для трекинга
- ✅ SQL функция для безопасного инкремента

### 5. Поиск и фильтры
- ✅ Поиск по названию, описанию и тегам с дебаунсом
- ✅ Фильтры по тегам (клик для выбора/снятия)
- ✅ Фильтр по уровню доступа
- ✅ Фильтр по видимости
- ✅ Кнопка "Сбросить" для очистки всех фильтров
- ✅ Счетчик результатов поиска

### 6. Массовые операции
- ✅ Чекбоксы для выбора статей (в заголовке и каждой строке)
- ✅ Панель массовых действий при выборе статей
- ✅ Массовое изменение видимости
- ✅ Массовое изменение уровня доступа
- ✅ Массовая установка бейджей NEW/UPDATED

### 7. Optimistic UI
- ✅ Мгновенное обновление UI при изменениях
- ✅ Использование `useTransition` для плавности
- ✅ Автоматический откат при ошибках API
- ✅ Локальное состояние для всех операций

## Производительность

- Дебаунс поиска (300ms) для оптимизации
- Мемоизация отфильтрованного списка
- Optimistic updates без блокировки UI
- Эффективные индексы БД для просмотров

## Важные замечания

⚠️ **Перед деплоем обязательно примените миграции БД!**

⚠️ Функция `incrementArticleView()` нужна для трекинга просмотров. Вызывайте её при открытии статьи пользователем (например, в компоненте отображения статьи).

⚠️ Если вы уже деплоили в Vercel, после применения миграций не забудьте:
1. Проверить переменные окружения (NEXT_PUBLIC_SUPABASE_URL, etc.)
2. Redeploy из GitHub для применения изменений кода

## Дополнительные возможности

В будущем можно добавить:
- Экспорт статистики просмотров
- Графики популярности статей
- Расширенную аналитику (время чтения, bounce rate)
- Scheduled публикации статей
